{
  "openapi": "3.1.1",
  "info": {
    "title": "Storedge Pricing Automation API",
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "https://rate-changer.replit.app"
    }
  ],
  "paths": {
    "/bucket-base-units": {
      "post": {
        "summary": "Get base unit groups and buckets for a site",
        "operationId": "bucketBaseUnits",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "site_number": {
                    "type": "string",
                    "description": "Storedge site number"
                  }
                },
                "required": ["site_number"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Base units and buckets retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "type": "object" }
                }
              }
            }
          },
          "400": { "description": "Missing or invalid site_number" }
        }
      }
    },
    "/bucket-calculate-rates-v2": {
      "post": {
        "summary": "Calculate rates for all unit groups in selected buckets",
        "description": "Requires both site_number and proposed_rates inside the params object. proposed_rates must be a dictionary with at least one bucket_number: base_rate pair.",
        "operationId": "bucketCalculateRatesV2",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "params": {
                    "type": "object",
                    "properties": {
                      "site_number": {
                        "type": "string",
                        "description": "Storedge site number"
                      },
                      "proposed_rates": {
                        "type": "object",
                        "additionalProperties": {
                          "type": "number"
                        },
                        "description": "Dictionary mapping bucket_number to base_rate"
                      }
                    },
                    "required": ["site_number", "proposed_rates"]
                  }
                },
                "required": ["params"]
              },
              "examples": {
                "correct": {
                  "value": {
                    "params": {
                      "site_number": "1034",
                      "proposed_rates": {
                        "4": 88,
                        "6": 88
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Rates calculated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "type": "object" }
                }
              }
            }
          },
          "400": { "description": "Missing or invalid parameters" }
        }
      }
    },
    "/filter-report": {
      "post": {
        "summary": "Filter the latest report by size, amenities, and other criteria",
        "operationId": "filterReport",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "size": { "type": "string", "nullable": true },
                  "amenities": { "type": "string", "nullable": true },
                  "unit_type": { "type": "string", "nullable": true },
                  "min_sf": { "type": "integer", "nullable": true },
                  "max_sf": { "type": "integer", "nullable": true },
                  "max_rows": { "type": "integer", "maximum": 100 }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Filtered report data",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "type": "object" }
                }
              }
            }
          }
        }
      }
    },
    "/gpt-upload-report": {
      "post": {
        "summary": "Upload updated pricing report",
        "operationId": "gptUploadReport",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "change_source": {
                    "type": "string",
                    "description": "Source of rate changes (e.g., 'bucket', 'manual')"
                  },
                  "csv_data": {
                    "type": "string",
                    "format": "byte",
                    "description": "Base64-encoded CSV containing rate changes"
                  }
                },
                "required": ["change_source", "csv_data"]
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Upload successful" },
          "400": { "description": "Invalid CSV or missing parameters" }
        }
      }
    },
    "/get_site_keys": {
      "get": {
        "summary": "Get the sE_ID for a single site by 4-digit site_number",
        "operationId": "getSiteKeys",
        "parameters": [
          {
            "name": "site_number",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "pattern": "^[0-9]{4}$"
            },
            "description": "4-digit site number (e.g., 1089)"
          }
        ],
        "responses": {
          "200": {
            "description": "Single site key retrieved successfully"
          },
          "400": {
            "description": "Missing or invalid site_number"
          },
          "404": {
            "description": "Site not found"
          }
        }
      }
    },
    "/wait-until-ready/{report_id}": {
      "get": {
        "summary": "Wait until report is ready",
        "operationId": "waitUntilReady",
        "parameters": [
          {
            "name": "report_id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" },
            "description": "ID of the report to check"
          }
        ],
        "responses": {
          "200": {
            "description": "Report status retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": { "type": "string" }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
